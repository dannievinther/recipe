---
import type { CollectionEntry } from "astro:content";
import { getCollection, render } from "astro:content";
import ArticleHeading from "../../components/ArticleHeading.astro";
import ArticleList from "../../components/ArticleList.astro";
import RecipePost from "../../components/RecipePost.astro";
import Markdown from "../../layouts/Markdown.astro";

type Props = {
  entry: CollectionEntry<"recipes">;
};

// 1. Generate a new path for every collection entry
export async function getStaticPaths() {
  const recipeEntries = await getCollection("recipes");
  return recipeEntries.map((entry) => ({
    // Use a pretty slug without the file extension (e.g., "morgenmad/aertevafler")
    params: { slug: entry.id.replace(/\.(md|mdx)$/i, "") },
    props: { entry },
  }));
}
// 2. When it's time to render, you can get the entry directly from the prop
const { entry } = Astro.props as Props;
const { Content } = await render(entry);

// Extract category from the entry id (e.g., "frokost/recipe.mdx" -> "Frokost")
const categorySlug = entry.id.split("/")[0];
const capitalizedSlug = `${categorySlug[0].toUpperCase()}${categorySlug.slice(1)}`;
---

<Markdown frontmatter={entry.data}>
  <RecipePost title={entry.data.title} category={capitalizedSlug}>
    <Content components={{ h2: ArticleHeading, li: ArticleList }} />
  </RecipePost>
</Markdown>
