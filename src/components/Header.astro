---
import { Icon } from "astro-icon";
import { Image } from "astro:assets";

// Normalize pathname (remove trailing slash except for root)
const rawPath = Astro.url.pathname;
const currentPath = rawPath !== "/" ? rawPath.replace(/\/$/, "") : "/";

// Header only on subpages (hide on frontpage "/")
const showHeader = currentPath !== "/";

// Choose image based on section
import snowflake from "../imgs/snowflake.jpg";
import chef from "../imgs/chef.png";
const sectionImage = currentPath.startsWith("/opskrifter")
  ? snowflake
  : currentPath.startsWith("/inspiration")
    ? chef
    : undefined;
---

<!-- <div class="header-shifter"></div> -->{
  showHeader && (
    <header class="header">
      <button class="back" type="button" id="backBtn">
        <Icon name="lucide:chevron-left" width="18" />
        Tilbage
      </button>
      <div class="logo">
        <a href="/">FogOp</a>
      </div>
      {sectionImage && (
        <div class="fillie">
          <Image
            format={"avif"}
            loading={"eager"}
            src={sectionImage}
            alt=""
            width={100}
            height={100}
          />
        </div>
      )}
    </header>
  )
}

<style>
  @layer components {
    header {
      view-transition-name: header;
      display: grid;
      grid-template-columns: 1fr auto 1fr;
      align-items: center;
      padding: 1rem;
      background: hsl(0 0% 100% / 90%);
      box-shadow:
        #3341551a 0 0 0 1px,
        #0000000d 0 20px 25px -5px,
        #0000000d 0 8px 10px -6px;
      -webkit-backdrop-filter: blur(5px);
      backdrop-filter: blur(5px);
      contain: layout paint;
    }

    @media (max-width: 640px) {
      header {
        position: fixed;
        inset: auto 0 0 0;
        z-index: 10;
      }
    }

    .logo {
      grid-column: 2;
    }

    .logo a {
      font-family: "Mona Sans", system-ui;
      font-size: var(--size-step-2);
      font-weight: 900;
      color: var(--text-body);
      text-decoration: none;
    }

    .fillie {
      grid-column: 3;
      justify-self: end;
    }

    .fillie img {
      inline-size: 40px;
      border-radius: var(--border-radius-round);
    }

    .back {
      background: #0000;
      border: 0;
      display: flex;
      font-weight: 500;
      align-items: center;
      color: var(--text-muted);
      font-size: var(--size-step--1);
      text-decoration: none;
    }
  }
</style>

<script>
  const backBtn = document.getElementById("backBtn");
  backBtn?.addEventListener("click", () => {
    const path = location.pathname.replace(/\/$/, "");
    if (path.startsWith("/inspiration")) {
      // Always send inspiration pages to the frontpage
      location.href = "/";
      return;
    }

    // Prefer browser history when available
    if (history.length > 1) {
      history.back();
      return;
    }

    // Fallback by section
    if (path.startsWith("/opskrifter")) {
      location.href = "/opskrifter/";
    } else {
      location.href = "/";
    }
  });
</script>
