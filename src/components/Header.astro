---
import { Image } from "astro:assets";
import ChevronLeftIcon from "../icons/chevron-left.svg";

// Normalize pathname (remove trailing slash except for root)
const rawPath = Astro.url.pathname;
const currentPath = rawPath !== "/" ? rawPath.replace(/\/$/, "") : "/";

// Header only on subpages (hide on frontpage "/")
const showHeader = currentPath !== "/";

// Choose image based on section
import snowflake from "../imgs/snowflake.jpg";
import chef from "../imgs/chef.png";
const sectionImage = currentPath.startsWith("/opskrifter")
  ? snowflake
  : currentPath.startsWith("/inspiration")
    ? chef
    : undefined;
---

<!-- <div class="header-shifter"></div> -->{
  showHeader && (
    <header class="header">
      <button class="back" type="button" id="backBtn">
        <ChevronLeftIcon class="icon" aria-hidden="true" />
        Tilbage
      </button>
      <div class="logo">
        <a href="/">FogOp</a>
      </div>
      {sectionImage && (
        <div class="fillie">
          <Image
            format={"avif"}
            loading={"lazy"}
            decoding={"async"}
            src={sectionImage}
            alt=""
            width={100}
            height={100}
          />
        </div>
      )}
    </header>
  )
}

<style>
  @layer components {
    header {
      display: grid;
      grid-template-columns: 1fr auto 1fr;
      align-items: center;
      padding: 1rem;
      background: linear-gradient(180deg, #fff, hsl(0 0% 100% / 94%));
      border-block-end: 1px solid var(--gray-200);
      box-shadow: 0 4px 14px hsl(210 20% 30% / 0.07);
    }

    @media (width <= 640px) {
      header {
        position: fixed;
        inset: auto 0 0 0;
        z-index: 10;
        padding-block-end: 2rlh;
        border-block-end: 0;
        border-block-start: 1px solid var(--gray-200);
      }
    }

    .logo {
      grid-column: 2;
    }

    .logo a {
      font-family: "Mona Sans", system-ui;
      font-size: var(--size-step-2);
      font-weight: 900;
      letter-spacing: 0.01em;
      color: var(--text-body);
      text-decoration: none;
      transition: color 0.18s ease;
    }

    .fillie {
      grid-column: 3;
      justify-self: end;
    }

    .fillie img {
      inline-size: 40px;
      border-radius: var(--border-radius-round);
      outline: 2px solid #fff;
      box-shadow: 0 2px 10px hsl(210 20% 30% / 0.2);
    }

    .back {
      background: #0000;
      border: 0;
      display: flex;
      gap: 0.1rem;
      font-weight: 500;
      align-items: center;
      color: var(--text-muted);
      font-size: var(--size-step--1);
      text-decoration: none;
      transition: color 0.18s ease, transform 0.18s ease;
    }

    .back .icon {
      width: 1rem;
      height: 1rem;
    }

    .back:active {
      transform: translateX(-1px);
      color: var(--text-body);
    }

    .logo a:active {
      color: var(--color-primary);
    }
  }
</style>

<script>
  const backBtn = document.getElementById("backBtn");
  backBtn?.addEventListener("click", () => {
    const path = location.pathname.replace(/\/$/, "");
    if (path.startsWith("/inspiration")) {
      // Always send inspiration pages to the frontpage
      location.href = "/";
      return;
    }

    // Prefer browser history when available
    if (history.length > 1) {
      history.back();
      return;
    }

    // Fallback by section
    if (path.startsWith("/opskrifter")) {
      location.href = "/opskrifter/";
    } else {
      location.href = "/";
    }
  });
</script>
